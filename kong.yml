# Versão do formato de configuração declarativa do Kong.
_format_version: "3.0"
_comment: "Configuração Kong com rotas ANINHADAS para máxima compatibilidade."

# ------------------------------------------------------------------------------
# 1. SERVIÇOS (SERVICES)
# Agora, cada serviço contém sua própria lista de rotas.
# ------------------------------------------------------------------------------
services:
  - name: supabase-auth
    url: http://auth:9999
    routes:
      - name: route-auth
        paths:
          - /auth/v1

  - name: supabase-rest
    url: http://rest:3000
    routes:
      - name: route-rest
        paths:
          - /rest/v1
          
  - name: supabase-realtime
    url: http://realtime:4000
    routes:
      - name: route-realtime
        paths:
          - /realtime/v1
          
  - name: supabase-storage
    url: http://storage:5000
    routes:
      - name: route-storage
        paths:
          - /storage/v1
          
  - name: supabase-functions
    url: http://functions:54321
    routes:
      - name: route-functions
        paths:
          - /functions/v1
          
  - name: supabase-studio
    url: http://studio:8000
    routes:
      - name: route-studio
        paths:
          - /

# ------------------------------------------------------------------------------
# 2. CONSUMERS, PLUGIN e CREDENCIAIS
# Estas seções não mudam e continuam como estão.
# ------------------------------------------------------------------------------
consumers:
  - username: anon-consumer
  - username: service-role-consumer

plugins:
  - name: key-auth
    config:
      key_names: ["apikey"]
      hide_credentials: true

keyauth_credentials:
  - consumer: anon-consumer
    key: ${SUPABASE_ANON_KEY}
  - consumer: service-role-consumer
    key: ${SUPABASE_SERVICE_KEY}
