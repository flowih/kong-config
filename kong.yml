# Versão do formato de configuração declarativa
_format_version: "3.0"
_comment: "Configuração Kong personalizada para a stack Supabase [CORRIGIDA]."

# ------------------------------------------------------------------------------
# 1. SERVIÇOS (SERVICES)
# Esta seção está correta e não precisa de alterações.
# ------------------------------------------------------------------------------
services:
  - name: supabase-auth
    url: http://auth:9999
  - name: supabase-rest
    url: http://rest:3000
  - name: supabase-realtime
    url: http://realtime:4000
  - name: supabase-storage
    url: http://storage:5000
  - name: supabase-functions
    url: http://functions:54321
  - name: supabase-studio
    url: http://studio:8000

# ------------------------------------------------------------------------------
# 2. ROTAS (ROUTES)
# Esta é a seção que foi corrigida.
# Note a mudança em cada 'service:'.
# ------------------------------------------------------------------------------
routes:
  - name: route-auth
    service: { name: 'supabase-auth' } # <--- CORRIGIDO
    paths:
      - /auth/v1

  - name: route-rest
    service: { name: 'supabase-rest' } # <--- CORRIGIDO
    paths:
      - /rest/v1

  - name: route-realtime
    service: { name: 'supabase-realtime' } # <--- CORRIGIDO
    paths:
      - /realtime/v1

  - name: route-storage
    service: { name: 'supabase-storage' } # <--- CORRIGIDO
    paths:
      - /storage/v1

  - name: route-functions
    service: { name: 'supabase-functions' } # <--- CORRIGIDO
    paths:
      - /functions/v1
      
  - name: route-studio
    service: { name: 'supabase-studio' } # <--- CORRIGIDO
    paths:
      - /

# ------------------------------------------------------------------------------
# 3. CONSUMERS, PLUGIN e CREDENCIAIS
# Estas seções estão corretas e não precisam de alterações.
# ------------------------------------------------------------------------------
consumers:
  - username: anon-consumer
  - username: service-role-consumer

plugins:
  - name: key-auth
    config:
      key_names: ["apikey"]
      hide_credentials: true

keyauth_credentials:
  - consumer: anon-consumer
    key: ${SUPABASE_ANON_KEY}
  - consumer: service-role-consumer
    key: ${SUPABASE_SERVICE_KEY}
